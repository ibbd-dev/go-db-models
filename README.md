# go-db-models

根据配置参数自动创建所有数据表的struct结构，每个结构独立为一个文件。

## INSTALL

```sh
go get github.com/ibbd-dev/go-db-models
```

## USAGE

```sh
# 生成struct
go-db-models -o host -d database -u username -p password -n packageName {json-file.json}

# 帮助
go-db-models -h
```

生成的文件:

- `common_gen_go`
- 表结构及查询文件`*_tb_gen.go`, 主要包含三部分内容：
  - 表结构定义
  - 单行结果查询函数
  - 多行结果查询函数

`*_tb_gen.go`文件样例如下：

```go
// DON'T EDIT *** generated by go-db-models *** DON'T EDIT //
package test

import "time"
import "strings"
import "database/sql"

// 对应数据表：ad_plan
type AdPlanTable struct {
	Id          uint32    `name:"id"`
	Name        string    `name:"name"`
	Status      uint8     `name:"status"`
	DailyBudget float64   `name:"daily_budget"`
	StartDate   time.Time `name:"start_date"`
	CreatedAt   time.Time `name:"created_at"`
}

const adPlanSelectFields string = "`id`,`name`,`status`,`daily_budget`,`start_date`,`created_at`"

// 查询单行记录
func AdPlanQueryRow(db *sql.DB, queryString string) (ad_plan *AdPlanTable, err error) {
	queryString = strings.Replace(queryString, SelectFieldsTemp, adPlanSelectFields, 1)
	ad_plan = &AdPlanTable{}
	err = db.QueryRow(queryString).Scan(
		&ad_plan.Id,
		&ad_plan.Name,
		&ad_plan.Status,
		&ad_plan.DailyBudget,
		&ad_plan.StartDate,
		&ad_plan.CreatedAt,
	)

	if err != nil {
		return nil, err
	}

	return ad_plan, nil
}

// 查询多行记录
func AdPlanQuery(db *sql.DB, queryString string) (ad_plan []*AdPlanTable, err error) {
	queryString = strings.Replace(queryString, SelectFieldsTemp, adPlanSelectFields, 1)
	rows, err := db.Query(queryString)
	if err != nil {
		return nil, err
	}
	defer rows.Close()

	for rows.Next() {
		var oneRow = &AdPlanTable{}
		err = rows.Scan(
			&oneRow.Id,
			&oneRow.Name,
			&oneRow.Status,
			&oneRow.DailyBudget,
			&oneRow.StartDate,
			&oneRow.CreatedAt,
		)
		if err != nil {
			return nil, err
		}

		ad_plan = append(ad_plan, oneRow)
	}

	return ad_plan, nil
}
```

## Json数据表定义文件

如果只是希望生成部分的数据表，则可以使用该文件。该文件的结构如：

```json
{
    // 需要生成的数据表
    "tables": [
        {
            // 数据表的名字
            "name": "ad_plan",
            // 需要生成的字段
            "fields": ["id", "name", "status", "daily_budget", "start_date", "created_at"]
        },
        {
            "name": "ad_project",
            "fields": ["id", "plan_id", "name", "status", "remark"]
        }
    ]
}
```

## TODO

- 查询缓存
- 连表查询

